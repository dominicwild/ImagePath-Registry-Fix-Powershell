$services = Get-ChildItem -path HKLM:\SYSTEM\CurrentControlSet\Services 

function fixPath([string]$path){
    $path = $path.trim()
    $path = '"' + $path + '"'
    Write-Host "Path corrected" $path
    
    $path
}

function border(){
    Write-Host "================="
}

$imagePaths = @()

$services | Get-Item | ForEach-Object {
    if($_.GetValueNames() -contains "ImagePath"){
        $imagePaths += $_.GetValue("ImagePath")
    }
}


foreach($imagePath in $imagePaths){

    border

    #$imagePath = Get-ItemPropertyValue -path $service.pspath -Name ImagePath
    Write-Host "Original Path:" $imagePath

    Select-String -Pattern '(.* .*\.\w+)(.*)' -InputObject $imagePath |
        Foreach-Object {
            $path, $args = $_.Matches[0].Groups[1..2].Value
            Write-Host "path:" $path
            $path = fixPath($path)
            $imagePath = $path + $args
        }

        Write-Host 'The full path is:' $imagePath

        border
}

